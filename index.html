<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rudhraan Home Foods & Spices | Authentic Homemade Goodness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#b45309">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/b45309/ffffff?text=R">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker Registered'))
                    .catch(err => console.log('Service Worker Failed', err));
            });
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        .font-playfair {
            font-family: 'Playfair Display', serif;
        }

        .hero-bg {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4)), url('https://i.pinimg.com/1200x/91/e5/a3/91e5a35502eb33e055c697077b07fce0.jpg?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            /* Parallax effect */
        }

        /* Cart Slide-in Animation */
        #cart-sidebar {
            transition: transform 0.3s ease-in-out;
        }

        .cart-open {
            transform: translateX(0) !important;
        }

        .cart-closed {
            transform: translateX(100%);
        }

        /* Smooth fade for products */
        .product-card {
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Toast Animation */
        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }

            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .toast {
            animation: slideUpFade 0.3s ease-out forwards;
        }

        /* Skeleton Animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            background-color: #e7e5e4;
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 relative overflow-x-hidden">

    <div class="bg-amber-900 text-amber-50 text-xs text-center py-2 tracking-wide uppercase font-semibold">
        ðŸŒ¿ Free Shipping on orders above â‚¹999 | 100% Homemade with Love
    </div>

    <header class="bg-white/95 backdrop-blur-md shadow-sm sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center gap-2 group">
                <div
                    class="w-8 h-8 bg-amber-600 rounded-full flex items-center justify-center text-white font-playfair font-bold group-hover:bg-amber-700 transition">
                    R</div>
                <span class="text-2xl font-bold font-playfair text-amber-900 tracking-tight">Rudhraan</span>
            </a>

            <div
                class="hidden md:flex items-center space-x-8 font-medium text-sm uppercase tracking-wide text-stone-600">
                <a href="#about" class="hover:text-amber-600 transition">Story</a>
                <a href="#products" class="hover:text-amber-600 transition">Shop</a>
                <a href="#reviews" class="hover:text-amber-600 transition">Reviews</a>
            </div>

            <div class="flex items-center space-x-5">
                <button id="search-toggle" class="text-stone-600 hover:text-amber-600 transition">
                    <i class="fas fa-search text-lg"></i>
                </button>
                <button id="wishlist-btn" class="text-stone-600 hover:text-red-500 transition relative">
                    <i class="far fa-heart text-xl"></i>
                    <span id="wishlist-count"
                        class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center opacity-0 transition-opacity">0</span>
                </button>
                <button id="cart-btn" class="text-stone-600 hover:text-amber-600 transition relative">
                    <i class="fas fa-shopping-bag text-xl"></i>
                    <span id="cart-count"
                        class="absolute -top-2 -right-2 bg-amber-600 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center opacity-0 transition-opacity">0</span>
                </button>
                <button id="mobile-menu-btn" class="md:hidden text-stone-800">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </nav>

        <div id="mobile-menu" class="hidden bg-white border-t md:hidden">
            <a href="#about" class="block px-6 py-3 text-stone-600 border-b hover:bg-amber-50">Story</a>
            <a href="#products" class="block px-6 py-3 text-stone-600 border-b hover:bg-amber-50">Shop</a>
            <a href="#contact" class="block px-6 py-3 text-stone-600 hover:bg-amber-50">Contact</a>
        </div>

        <div id="search-bar" class="hidden bg-white border-t p-4 absolute w-full shadow-lg z-30">
            <div class="container mx-auto max-w-2xl relative">
                <i class="fas fa-search absolute left-4 top-3.5 text-gray-400"></i>
                <input type="text" id="global-search" placeholder="Search for pickles, powders, or malts..."
                    class="w-full bg-stone-100 rounded-full py-3 pl-12 pr-4 outline-none focus:ring-2 focus:ring-amber-500">
            </div>
        </div>
    </header>

    <section class="hero-bg text-white h-[70vh] flex items-center relative">
        <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-transparent"></div>
        <div class="container mx-auto px-6 text-center relative z-10 pt-10">
            <span
                class="bg-amber-600/90 text-white px-4 py-1 rounded-full text-xs uppercase tracking-widest font-semibold mb-6 inline-block animate-pulse">Est.
                2020</span>
            <h1 class="text-5xl md:text-7xl font-playfair font-bold mb-6 drop-shadow-xl leading-tight">
                Tradition in <br /> Every Spoonful
            </h1>
            <p class="text-lg md:text-xl max-w-2xl mx-auto mb-10 text-stone-200 font-light">
                Handcrafted pickles, aromatic spice blends, and healthy malts made in our home kitchen, delivered to
                yours.
            </p>
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <a href="#products"
                    class="bg-amber-600 hover:bg-amber-700 text-white py-4 px-8 rounded-full font-semibold transition transform hover:scale-105 shadow-lg shadow-amber-900/50">
                    Shop Now
                </a>
                <a href="#about"
                    class="bg-white/10 backdrop-blur-sm hover:bg-white/20 text-white border border-white/30 py-4 px-8 rounded-full font-semibold transition">
                    Our Story
                </a>
            </div>
        </div>
    </section>

    <section class="py-12 bg-white border-b border-stone-100">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                <div class="p-4">
                    <i class="fas fa-hand-holding-heart text-4xl text-amber-600 mb-4"></i>
                    <h3 class="font-bold text-stone-800">Handmade</h3>
                    <p class="text-sm text-stone-500">Made in small batches</p>
                </div>
                <div class="p-4">
                    <i class="fas fa-leaf text-4xl text-amber-600 mb-4"></i>
                    <h3 class="font-bold text-stone-800">100% Natural</h3>
                    <p class="text-sm text-stone-500">No artificial preservatives</p>
                </div>
                <div class="p-4">
                    <i class="fas fa-mortar-pestle text-4xl text-amber-600 mb-4"></i>
                    <h3 class="font-bold text-stone-800">Traditional</h3>
                    <p class="text-sm text-stone-500">Authentic family recipes</p>
                </div>
                <div class="p-4">
                    <i class="fas fa-truck text-4xl text-amber-600 mb-4"></i>
                    <h3 class="font-bold text-stone-800">Shipping</h3>
                    <p class="text-sm text-stone-500">Pan-India Delivery</p>
                </div>
            </div>
        </div>
    </section>

    <section id="about" class="py-20 bg-stone-50">
        <div class="container mx-auto px-6 flex flex-col md:flex-row items-center gap-12">
            <div class="md:w-1/2">
                <img src="https://i.pinimg.com/736x/b9/21/6b/b9216b8bea73f1f7d54f13245f19ccaa.jpg?auto=format&fit=crop&w=800&q=80"
                    alt="Spices" class="rounded-2xl shadow-2xl">
            </div>
            <div class="md:w-1/2 text-left">
                <h2 class="text-4xl font-playfair font-bold text-amber-900 mb-6">Rooted in Heritage</h2>
                <div class="w-20 h-1 bg-amber-500 mb-8"></div>
                <p class="text-stone-600 leading-relaxed mb-6 text-lg">
                    At Rudhraan, we don't utilize factories; we use a kitchen. Our journey began with a simple thought:
                    why is it so hard to find the taste of grandmother's pickles in the city?
                </p>
                <p class="text-stone-600 leading-relaxed mb-8">
                    We hand-select our raw materials from local farmers, sun-dry our chilies, and stone-grind our
                    spices. Every jar that leaves our home is a promise of purity and nostalgia.
                </p>
                <button class="text-amber-700 font-bold hover:text-amber-900 flex items-center gap-2 group">
                    Read Full Story <i class="fas fa-arrow-right transform group-hover:translate-x-1 transition"></i>
                </button>
            </div>
        </div>
    </section>

    <section id="products" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-playfair font-bold text-amber-900 mb-4">Our Pantry</h2>
                <p class="text-stone-500">Select a category to filter products</p>
            </div>

            <div id="filter-buttons"
                class="flex overflow-x-auto no-scrollbar whitespace-nowrap gap-3 mb-12 px-4 md:justify-center md:px-0 pb-2">
                <button
                    class="filter-btn bg-amber-700 text-white py-2 px-6 rounded-full shadow-lg hover:bg-amber-800 transition duration-300 text-sm font-medium uppercase tracking-wider flex-shrink-0"
                    data-category="all">All</button>
            </div>

            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            </div>
        </div>
    </section>

    <section id="reviews" class="py-20 bg-amber-50">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-3xl font-playfair font-bold text-amber-900 mb-12">What Our Family Says</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-xl shadow-sm border border-amber-100">
                    <div class="text-amber-500 text-sm mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                            class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-stone-600 italic mb-6">"The Ragi Malt is a game changer for my kids' breakfast. It
                        tastes so fresh compared to store-bought ones."</p>
                    <h4 class="font-bold text-stone-800">- Rakesh B.</h4>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-amber-100">
                    <div class="text-amber-500 text-sm mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                            class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-stone-600 italic mb-6">"The Tomato Pickle took me back to my childhood village.
                        Absolutely authentic taste!"</p>
                    <h4 class="font-bold text-stone-800">- BhanuTeja V.</h4>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-amber-100">
                    <div class="text-amber-500 text-sm mb-4"><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                            class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-stone-600 italic mb-6">"I ordered the customized bulk spice powders for my wedding
                        return gifts. Everyone loved it."</p>
                    <h4 class="font-bold text-stone-800">- Vinay B.</h4>
                </div>
            </div>
        </div>
    </section>

    <footer id="contact" class="bg-stone-900 text-stone-300 py-16">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-4 gap-12 mb-12">
                <div>
                    <h3 class="text-2xl font-playfair font-bold text-white mb-6">Rudhraan</h3>
                    <p class="text-stone-400 mb-6">Bringing the authentic taste of homemade goodness right to your
                        kitchen.</p>
                    <div class="flex space-x-4">
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-stone-800 flex items-center justify-center hover:bg-amber-600 transition"><i
                                class="fab fa-instagram"></i></a>
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-stone-800 flex items-center justify-center hover:bg-amber-600 transition"><i
                                class="fab fa-facebook-f"></i></a>
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-stone-800 flex items-center justify-center hover:bg-amber-600 transition"><i
                                class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="#about" class="hover:text-amber-500 transition">Our Story</a></li>
                        <li><a href="#products" class="hover:text-amber-500 transition">Products</a></li>
                        <li><button onclick="openPolicyModal('shipping')"
                                class="hover:text-amber-500 transition text-left">Shipping Policy</button></li>
                        <li><button onclick="openPolicyModal('contact')"
                                class="hover:text-amber-500 transition text-left">Contact Us</button></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Contact</h4>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-3"><i class="fas fa-map-marker-alt mt-1 text-amber-500"></i>
                            Hindupur, Andhra Pradesh, India</li>
                        <li class="flex items-start gap-3"><i class="fas fa-phone mt-1 text-amber-500"></i> +91
                            738-637-5813</li>
                        <li class="flex items-start gap-3"><i class="fas fa-envelope mt-1 text-amber-500"></i>
                            rudhraanfoods@gmail.com</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Newsletter</h4>
                    <p class="text-sm text-stone-400 mb-4">Subscribe for recipes and offers.</p>
                    <div class="flex">
                        <input type="email" placeholder="Your email"
                            class="bg-stone-800 text-white px-4 py-2 rounded-l-lg w-full outline-none focus:ring-1 focus:ring-amber-500">
                        <button class="bg-amber-600 px-4 py-2 rounded-r-lg hover:bg-amber-700 transition">GO</button>
                    </div>
                </div>
            </div>
            <div class="border-t border-stone-800 pt-8 text-center text-sm text-stone-500">
                &copy; 2024 Rudhraan Home Foods & Spices. All Rights Reserved.
            </div>
        </div>
    </footer>

    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-50 hidden transition-opacity"></div>
    <div id="cart-sidebar"
        class="fixed top-0 right-0 h-full w-full md:w-[400px] bg-white z-50 shadow-2xl flex flex-col cart-closed">
        <div class="p-6 border-b flex justify-between items-center bg-stone-50">
            <h2 class="text-xl font-playfair font-bold text-stone-800">Your Basket</h2>
            <button id="close-cart" class="text-stone-500 hover:text-red-500 transition"><i
                    class="fas fa-times text-xl"></i></button>
        </div>

        <div id="cart-items" class="flex-grow overflow-y-auto p-6 space-y-6">
            <div class="text-center text-stone-400 mt-10">
                <i class="fas fa-shopping-basket text-4xl mb-3"></i>
                <p>Your basket is empty.</p>
            </div>
        </div>

        <div class="p-6 border-t bg-stone-50">
            <div class="flex justify-between mb-4 text-lg font-bold text-stone-800">
                <span>Total</span>
                <span id="cart-total">â‚¹0</span>
            </div>
            <button id="checkout-btn"
                class="w-full bg-green-600 text-white py-4 rounded-lg font-bold shadow-md hover:bg-green-700 transition flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-xl"></i> Order via WhatsApp
            </button>
            <p class="text-xs text-center text-stone-500 mt-3">We will confirm shipping costs on chat.</p>
        </div>
    </div>

    <!-- Wishlist Slide-in Animation -->
    <div id="wishlist-sidebar"
        class="fixed top-0 right-0 h-full w-full md:w-[400px] bg-white z-50 shadow-2xl flex flex-col cart-closed">
        <div class="p-6 border-b flex justify-between items-center bg-stone-50">
            <h2 class="text-xl font-playfair font-bold text-stone-800">Your Wishlist</h2>
            <button id="close-wishlist" class="text-stone-500 hover:text-red-500 transition"><i
                    class="fas fa-times text-xl"></i></button>
        </div>

        <div id="wishlist-items" class="flex-grow overflow-y-auto p-6 space-y-6">
            <div class="text-center text-stone-400 mt-10">
                <i class="far fa-heart text-4xl mb-3"></i>
                <p>Your wishlist is empty.</p>
            </div>
        </div>

        <div class="p-6 border-t bg-stone-50">
            <button onclick="toggleWishlistSidebar(false); toggleCart(true);"
                class="w-full bg-amber-600 text-white py-4 rounded-lg font-bold shadow-md hover:bg-amber-700 transition flex items-center justify-center gap-2">
                <i class="fas fa-shopping-bag text-xl"></i> View Cart
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-amber-700 p-4 flex justify-between items-center text-white">
                <h3 class="font-playfair font-bold text-lg">Complete Your Order</h3>
                <button onclick="closeCheckoutModal()" class="hover:text-amber-200"><i
                        class="fas fa-times"></i></button>
            </div>
            <form onsubmit="submitOrder(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-1">Full Name</label>
                    <input type="text" id="customer-name" required
                        class="w-full border border-stone-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-500 outline-none">
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-1">Delivery Address</label>
                    <textarea id="customer-address" required rows="3"
                        class="w-full border border-stone-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-500 outline-none"></textarea>
                </div>
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase mb-1">Pincode</label>
                    <input type="text" id="customer-pincode" required pattern="[0-9]{6}"
                        class="w-full border border-stone-300 rounded-lg p-2 focus:ring-2 focus:ring-amber-500 outline-none">
                </div>
                <button type="submit"
                    class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp text-xl"></i> Send Order on WhatsApp
                </button>
            </form>
        </div>
    </div>
    </div>

    <!-- Policy Modal -->
    <div id="policy-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto">
            <div class="bg-stone-100 p-6 border-b flex justify-between items-center sticky top-0">
                <h3 id="policy-title" class="font-playfair font-bold text-2xl text-amber-900">Policy</h3>
                <button onclick="closePolicyModal()" class="text-stone-500 hover:text-red-500 transition"><i
                        class="fas fa-times text-xl"></i></button>
            </div>
            <div id="policy-content" class="p-8 text-stone-600 leading-relaxed space-y-4">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-[70] space-y-2"></div>

    <script>
        // --- State Management ---
        const state = {
            products: [],
            cart: JSON.parse(localStorage.getItem('rudhraan_cart')) || [],
            wishlist: JSON.parse(localStorage.getItem('rudhraan_wishlist')) || [],
            activeCategory: 'all',
            searchQuery: ''
        };

        // --- CSV Data Loading ---
        // Removed hardcoded csvData. Now fetching from products.csv


        // --- Configuration ---
        // REPLACE THIS URL with your own Google Sheet "Published to Web" CSV link
        // 1. Open Google Sheet -> File -> Share -> Publish to web
        // 2. Select "Entire Document" and "Comma-separated values (.csv)"
        // 3. Click Publish and copy the link below
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSWCYDfcaJur6IOOr6q1Qv97OqB_4CxjyI7WtZ6zd6CWBhRbAqPlHNXOO8PPM4x0rOVm3UODr6TWpIU/pub?output=csv';

        // Note: I've put a dummy link above. 
        // For now, I will use a fallback to 'products.csv' if the URL is invalid or empty for testing purposes.
        // But the logic below prioritizes the Sheet URL.

        // --- DOM Elements ---
        const els = {
            productGrid: document.getElementById('product-grid'),
            filterContainer: document.getElementById('filter-buttons'),
            searchInput: document.getElementById('global-search'),
            searchBar: document.getElementById('search-bar'),
            searchToggle: document.getElementById('search-toggle'),
            cartBtn: document.getElementById('cart-btn'),
            cartSidebar: document.getElementById('cart-sidebar'),
            cartOverlay: document.getElementById('cart-overlay'),
            closeCart: document.getElementById('close-cart'),
            cartItems: document.getElementById('cart-items'),
            cartTotal: document.getElementById('cart-total'),
            cartCount: document.getElementById('cart-count'),
            checkoutBtn: document.getElementById('checkout-btn'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mobileMenu: document.getElementById('mobile-menu'),
            wishlistBtn: document.getElementById('wishlist-btn'),
            wishlistSidebar: document.getElementById('wishlist-sidebar'),
            closeWishlist: document.getElementById('close-wishlist'),
            wishlistItems: document.getElementById('wishlist-items'),
            wishlistCount: document.getElementById('wishlist-count'),
            toastContainer: document.getElementById('toast-container')
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if cart/wishlist has items and update UI immediately
            if (state.cart.length > 0) renderCart();
            if (state.wishlist.length > 0) renderWishlist();

            // Show Skeleton Loading
            renderSkeleton();

            // Fetch Data from Google Sheets
            fetch(GOOGLE_SHEET_URL)
                .then(response => {
                    if (!response.ok) throw new Error("Network response was not ok");
                    return response.text();
                })
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function (results) {
                            processData(results.data);
                        }
                    });
                })
                .catch(error => {
                    console.error("Error loading products:", error);
                    alert("Could not load products. Please check your Google Sheet Link or Internet Connection.");
                });
        });

        function processData(data) {
            state.products = data.map((p, index) => ({
                id: index,
                category: p.Category ? sanitize(p.Category.trim()) : 'Uncategorized', // Trim whitespace to prevent duplicates
                name: sanitize(p['Product Name']),
                variant: p['Variant / Type'] === '-' ? '' : sanitize(p['Variant / Type']),
                price: parseInt(p.Price) || 0,
                sizes: sanitize(p['Available Sizes (g/kg)']),
                image: sanitize(p.ImageURL) || getPlaceholderImage(p.Category, p['Product Name'])
            }));
            initApp();
        }

        function initApp() {
            renderFilters();
            renderProducts();
            setupEventListeners();
        }

        // --- Helpers ---
        function sanitize(str) {
            if (!str) return '';
            if (typeof str !== 'string') return str;
            return str.replace(/[&<>"']/g, function (m) {
                switch (m) {
                    case '&': return '&amp;';
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case '"': return '&quot;';
                    case "'": return '&#039;';
                }
            });
        }

        function getPlaceholderImage(category, name) {
            const keywords = {
                'Flours': 'flour',
                'Malts': 'health drink powder',
                'Pickles': 'indian pickle jar',
                'Spices': 'red chilli powder',
                'Dry Fruits': 'almonds cashews',
                'Instant Masalas': 'spices spoon'
            };
            const term = keywords[category] || 'food';
            return `https://placehold.co/400x300/FDE68A/451A03?text=${encodeURIComponent(name)}\n(â‚¹${Math.floor(Math.random() * 100 + 100)})`;
        }

        // --- Rendering ---
        function renderFilters() {
            const categories = ['all', ...new Set(state.products.map(p => p.category))];
            els.filterContainer.innerHTML = categories.map(cat => `
                <button class="filter-btn ${cat === 'all' ? 'bg-amber-700 text-white' : 'bg-white text-stone-600'} py-2 px-5 rounded-full shadow-sm hover:bg-amber-100 border border-stone-200 transition duration-300 text-sm font-medium uppercase tracking-wider flex-shrink-0" data-category="${cat}">
                    ${cat}
                </button>
            `).join('');
        }

        function renderSkeleton() {
            els.productGrid.innerHTML = Array(8).fill(0).map(() => `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-100 h-[400px] flex flex-col">
                    <div class="h-48 skeleton w-full"></div>
                    <div class="p-5 flex-grow flex flex-col gap-3">
                        <div class="h-4 skeleton w-1/3 rounded"></div>
                        <div class="h-6 skeleton w-3/4 rounded"></div>
                        <div class="h-4 skeleton w-1/2 rounded"></div>
                        <div class="mt-auto flex justify-between items-center pt-4">
                            <div class="h-8 skeleton w-1/4 rounded"></div>
                            <div class="h-10 skeleton w-1/3 rounded-lg"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderProducts() {
            const filtered = state.products.filter(p => {
                const matchesCategory = state.activeCategory === 'all' || p.category === state.activeCategory;
                const matchesSearch = p.name.toLowerCase().includes(state.searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            if (filtered.length === 0) {
                els.productGrid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="inline-block p-6 bg-stone-50 rounded-full mb-4">
                            <i class="fas fa-search text-4xl text-stone-300"></i>
                        </div>
                        <h3 class="text-xl font-bold text-stone-800 mb-2">No products found</h3>
                        <p class="text-stone-500 mb-6">We couldn't find matches for "${state.searchQuery}"</p>
                        <button onclick="clearSearch()" class="text-amber-600 font-bold hover:underline">Clear Search</button>
                    </div>
                `;
                return;
            }

            els.productGrid.innerHTML = filtered.map(product => {
                const isWishlisted = state.wishlist.some(item => item.id === product.id);
                return `
                <div class="product-card bg-white rounded-xl shadow-md overflow-hidden flex flex-col h-full border border-stone-100 group relative">
                    <button onclick="toggleWishlist(${product.id})" class="absolute top-3 right-3 z-10 w-8 h-8 rounded-full bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-sm transition hover:bg-white text-stone-400 hover:text-red-500 ${isWishlisted ? 'text-red-500' : ''}">
                        <i class="${isWishlisted ? 'fas' : 'far'} fa-heart"></i>
                    </button>
                    <div class="relative overflow-hidden h-48">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transition transform group-hover:scale-110 duration-500">
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <div class="text-xs text-amber-600 font-bold uppercase tracking-widest mb-1">${product.category}</div>
                        <h3 class="text-lg font-bold text-stone-800 leading-tight mb-1">${product.name}</h3>
                        ${product.variant ? `<p class="text-xs text-stone-500 italic mb-3">${product.variant}</p>` : '<div class="mb-3"></div>'}
                        
                        <div class="mt-auto pt-4 border-t border-stone-100 flex items-center justify-between">
                            <div class="flex flex-col">
                                <span class="text-xs text-stone-500 mb-1">Size: ${product.sizes.split(',')[0]}</span>
                                <span class="text-xl font-bold text-amber-700">â‚¹${product.price}</span>
                            </div>
                            <button onclick="addToCart(${product.id})" class="bg-stone-800 hover:bg-amber-600 text-white text-sm px-6 py-2 rounded-lg transition flex items-center gap-2 shadow-sm">
                                Add <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderCart() {
            if (state.cart.length === 0) {
                els.cartItems.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-stone-400">
                        <i class="fas fa-shopping-basket text-5xl mb-4 opacity-50"></i>
                        <p>Your basket is empty.</p>
                        <button onclick="toggleCart()" class="mt-4 text-amber-600 font-bold text-sm hover:underline">Start Shopping</button>
                    </div>`;
                els.cartTotal.innerText = 'â‚¹0';
                els.cartCount.style.opacity = '0';
                return;
            }

            let total = 0;
            let totalItems = 0;

            els.cartItems.innerHTML = state.cart.map(item => {
                total += item.price * item.qty;
                totalItems += item.qty;
                return `
                    <div class="flex gap-4 items-center bg-stone-50 p-3 rounded-lg border border-stone-100">
                        <img src="${item.image}" class="w-16 h-16 object-cover rounded-md">
                        <div class="flex-grow">
                            <h4 class="font-bold text-stone-800 text-sm">${item.name}</h4>
                            <p class="text-xs text-stone-500">â‚¹${item.price} x ${item.qty}</p>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <div class="flex items-center bg-white rounded shadow-sm border">
                                <button onclick="updateQty(${item.id}, -1)" class="px-2 text-stone-600 hover:text-red-500">-</button>
                                <span class="text-xs font-bold px-1 w-4 text-center">${item.qty}</span>
                                <button onclick="updateQty(${item.id}, 1)" class="px-2 text-stone-600 hover:text-green-500">+</button>
                            </div>
                            <span class="text-sm font-bold text-amber-700">â‚¹${item.price * item.qty}</span>
                        </div>
                    </div>
                `;
            }).join('');

            els.cartTotal.innerText = 'â‚¹' + total;
            els.cartCount.innerText = totalItems;
            els.cartCount.style.opacity = totalItems > 0 ? '1' : '0';
        }

        function renderWishlist() {
            if (state.wishlist.length === 0) {
                els.wishlistItems.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-stone-400">
                        <i class="far fa-heart text-5xl mb-4 opacity-50"></i>
                        <p>Your wishlist is empty.</p>
                    </div>`;
                els.wishlistCount.style.opacity = '0';
                return;
            }

            els.wishlistItems.innerHTML = state.wishlist.map(item => `
                <div class="flex gap-4 items-center bg-stone-50 p-3 rounded-lg border border-stone-100">
                    <img src="${item.image}" class="w-16 h-16 object-cover rounded-md">
                    <div class="flex-grow">
                        <h4 class="font-bold text-stone-800 text-sm">${item.name}</h4>
                        <p class="text-xs text-stone-500">â‚¹${item.price}</p>
                    </div>
                    <button onclick="addToCart(${item.id})" class="text-amber-600 hover:text-amber-800 text-sm font-bold px-2">
                        Add
                    </button>
                    <button onclick="toggleWishlist(${item.id})" class="text-stone-400 hover:text-red-500 px-2">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            els.wishlistCount.innerText = state.wishlist.length;
            els.wishlistCount.style.opacity = '1';
        }

        // --- Actions ---
        window.addToCart = (id) => {
            const product = state.products.find(p => p.id === id);
            const existing = state.cart.find(item => item.id === id);

            if (existing) {
                existing.qty++;
            } else {
                state.cart.push({ ...product, qty: 1 });
            }

            renderCart();
            saveCart();
            // toggleCart(true); // REMOVED: Don't auto-open cart
            showToast(`Added ${product.name} to cart`);
        };

        window.toggleWishlist = (id) => {
            const index = state.wishlist.findIndex(item => item.id === id);

            if (index === -1) {
                const product = state.products.find(p => p.id === id);
                state.wishlist.push(product);
                showToast(`Added to wishlist`);
            } else {
                state.wishlist.splice(index, 1);
                showToast(`Removed from wishlist`);
            }

            saveWishlist();
            renderWishlist();
            renderProducts(); // Re-render to update heart icons
        };

        function saveCart() {
            localStorage.setItem('rudhraan_cart', JSON.stringify(state.cart));
        }

        function saveWishlist() {
            localStorage.setItem('rudhraan_wishlist', JSON.stringify(state.wishlist));
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast bg-stone-800 text-white px-6 py-3 rounded-full shadow-lg text-sm font-medium flex items-center gap-2';
            toast.innerHTML = `<i class="fas fa-check-circle text-green-400"></i> ${message}`;

            els.toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        window.updateQty = (id, change) => {
            const index = state.cart.findIndex(item => item.id === id);
            if (index === -1) return;

            const item = state.cart[index];
            item.qty += change;

            if (item.qty <= 0) {
                state.cart.splice(index, 1);
            }
            saveCart();
            renderCart();
        };

        window.toggleCart = (forceOpen = null) => {
            const isOpen = !els.cartSidebar.classList.contains('cart-closed');
            const shouldOpen = forceOpen !== null ? forceOpen : !isOpen;

            if (shouldOpen) {
                els.cartSidebar.classList.remove('cart-closed');
                els.cartSidebar.classList.add('cart-open');
                els.cartOverlay.classList.remove('hidden');
            } else {
                els.cartSidebar.classList.add('cart-closed');
                els.cartSidebar.classList.remove('cart-open');
                els.cartOverlay.classList.add('hidden');
            }
        };

        window.toggleWishlistSidebar = (forceOpen = null) => {
            const isOpen = !els.wishlistSidebar.classList.contains('cart-closed');
            const shouldOpen = forceOpen !== null ? forceOpen : !isOpen;

            if (shouldOpen) {
                els.wishlistSidebar.classList.remove('cart-closed');
                els.wishlistSidebar.classList.add('cart-open');
                els.cartOverlay.classList.remove('hidden');
                // Close cart if open
                if (!els.cartSidebar.classList.contains('cart-closed')) toggleCart(false);
            } else {
                els.wishlistSidebar.classList.add('cart-closed');
                els.wishlistSidebar.classList.remove('cart-open');
                if (els.cartSidebar.classList.contains('cart-closed')) els.cartOverlay.classList.add('hidden');
            }
        };

        function checkoutWhatsApp() {
            if (state.cart.length === 0) return;
            // Show Modal
            document.getElementById('checkout-modal').classList.remove('hidden');
        }

        function submitOrder(e) {
            e.preventDefault();
            const name = document.getElementById('customer-name').value;
            const address = document.getElementById('customer-address').value;
            const pincode = document.getElementById('customer-pincode').value;

            if (!name || !address || !pincode) {
                alert("Please fill in all details");
                return;
            }

            let message = `Hello Rudhraan Foods! I would like to place an order:\n\n*Customer Details:*\nName: ${name}\nAddress: ${address}, ${pincode}\n\n*Order Summary:*\n`;

            state.cart.forEach(item => {
                message += `â–ª ${item.name} (${item.qty} x â‚¹${item.price})\n`;
            });

            const total = document.getElementById('cart-total').innerText;
            message += `\n*Total Value: ${total}*`;
            message += `\n\nPlease confirm availability and shipping cost.`;

            const encodedMsg = encodeURIComponent(message);
            window.open(`https://wa.me/917386375813?text=${encodedMsg}`, '_blank');

            // Optional: Clear cart after order? 
            // state.cart = []; saveCart(); renderCart(); toggleCart(false);
            document.getElementById('checkout-modal').classList.add('hidden');
        }

        function closeCheckoutModal() {
            document.getElementById('checkout-modal').classList.add('hidden');
        }

        window.clearSearch = () => {
            state.searchQuery = '';
            els.searchInput.value = '';
            renderProducts();
        };

        window.openPolicyModal = (type) => {
            const modal = document.getElementById('policy-modal');
            const title = document.getElementById('policy-title');
            const content = document.getElementById('policy-content');

            modal.classList.remove('hidden');

            if (type === 'shipping') {
                title.innerText = "Shipping Policy";
                content.innerHTML = `
                    <p><strong>Delivery Areas:</strong> We currently ship to all major cities and towns across India.</p>
                    <p><strong>Dispatch Time:</strong> Since our products are homemade and fresh, we dispatch orders within 2-3 days of confirmation.</p>
                    <p><strong>Delivery Time:</strong> Standard delivery takes 5-7 working days depending on your location.</p>
                    <p><strong>Shipping Charges:</strong> Shipping is calculated based on weight and distance. Free shipping is available on orders above â‚¹999.</p>
                `;
            } else if (type === 'contact') {
                title.innerText = "Contact Us";
                content.innerHTML = `
                    <p class="flex items-center gap-3"><i class="fas fa-map-marker-alt text-amber-600 text-xl w-6"></i> <span><strong>Address:</strong><br>Rudhraan Home Foods, Hindupur, Andhra Pradesh, India - 515201</span></p>
                    <p class="flex items-center gap-3"><i class="fas fa-phone text-amber-600 text-xl w-6"></i> <span><strong>Phone:</strong><br>+91 738-637-5813</span></p>
                    <p class="flex items-center gap-3"><i class="fas fa-envelope text-amber-600 text-xl w-6"></i> <span><strong>Email:</strong><br>rudhraanfoods@gmail.com</span></p>
                    <p class="mt-4 text-sm text-stone-500">We are available Mon-Sat from 9 AM to 7 PM.</p>
                `;
            }
        };

        window.closePolicyModal = () => {
            document.getElementById('policy-modal').classList.add('hidden');
        };

        // --- Event Listeners ---
        function setupEventListeners() {
            els.filterContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    // Update Active State
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('bg-amber-700', 'text-white');
                        b.classList.add('bg-white', 'text-stone-600');
                    });
                    e.target.classList.remove('bg-white', 'text-stone-600');
                    e.target.classList.add('bg-amber-700', 'text-white');

                    state.activeCategory = e.target.dataset.category;
                    renderProducts();
                }
            });

            els.searchToggle.addEventListener('click', () => {
                els.searchBar.classList.toggle('hidden');
                if (!els.searchBar.classList.contains('hidden')) els.searchInput.focus();
            });

            els.searchInput.addEventListener('input', (e) => {
                state.searchQuery = e.target.value;
                renderProducts();
            });

            els.cartBtn.addEventListener('click', () => toggleCart());
            els.closeCart.addEventListener('click', () => toggleCart(false));

            els.wishlistBtn.addEventListener('click', () => toggleWishlistSidebar());
            els.closeWishlist.addEventListener('click', () => toggleWishlistSidebar(false));

            els.cartOverlay.addEventListener('click', () => {
                toggleCart(false);
                toggleWishlistSidebar(false);
            });
            els.checkoutBtn.addEventListener('click', checkoutWhatsApp);

            els.mobileMenuBtn.addEventListener('click', () => {
                els.mobileMenu.classList.toggle('hidden');
            });
        }
    </script>
</body>

</html>